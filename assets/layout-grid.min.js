+function(a,b){"use strict";function c(b,c){var d=JSON.stringify({LTWidget:"#"+c.lt_ensure_id().attr("id")});a.lt.currentEventData=d,b.originalEvent.dataTransfer&&b.originalEvent.dataTransfer.setData("text/plain",d)}function d(b){var c=b.originalEvent.dataTransfer&&b.originalEvent.dataTransfer.getData("text/plain")||a.lt.currentEventData;if(c){var d=JSON.parse(c);return a(d.LTWidget)}}function e(b,c,d,e){return this.each(function(){var f=a(this),g=f.data("lt-grid"),i=a.extend(!0,{},h.DEFAULTS,f.data(),"object"==typeof b&&b);g||f.data("lt-grid",g=new h(this,i)),"string"==typeof b&&g[b](c,d,e)})}var f=function(a,b,c,d){this.x=a||0,this.y=b||0,this.w=c||1,this.h=d||1};f.prototype.bottom=function(){return this.y+this.h},f.prototype.right=function(){return this.x+this.w},f.prototype.intersect=function(a){return this.x<a.right()&&this.right()>a.x&&this.y<a.bottom()&&this.bottom()>a.y},f.prototype.setCss=function(a,b){var c=this;return["x","y","w","h"].forEach(function(d){a=a.replace(new RegExp("lt-"+b+"-"+d+"-(\\d+)"),"lt-"+b+"-"+d+"-"+c[d])}),a},f.prototype.loadCss=function(a,b){var c=this;return["x","y","w","h"].forEach(function(d){var e=a.match(new RegExp("lt-"+b+"-"+d+"-(\\d+)"));e&&(c[d]=parseInt(e[1]))}),this};var g=function(a){this.rects=a||[]};g.prototype.getIntersectingRects=function(b){return a.grep(this.rects,function(a){return b!==a&&b.intersect(a)})},g.prototype.compact=function(){var b=this,c=this.rects.slice(0).sort(function(a,b){return a.y-b.y});return a.each(c,function(){do this.y-=1;while(this.y>=0&&0===b.getIntersectingRects(this).length);this.y+=1}),this},g.prototype.height=function(){var b=a.map(this.rects,function(a){return a.bottom()});return b?Math.max.apply(null,b):0},g.prototype.moveNoOverlap=function(b,c,d){var e=this;return this.move(b,c,d),a.each(this.getIntersectingRects(b),function(){e.moveNoOverlap(this,this.x,b.bottom())}),this},g.prototype.move=function(a,b,c){return a.x=b,a.y=c,this},a.fn.lt_rect=function(a,c){return b===c?(b===this.data("lt-item-"+a)&&this.data("lt-item-"+a,(new f).loadCss(this.attr("class"),a)),this.data("lt-item-"+a)):(this.data("lt-item-"+a,c),this.attr("class",c.setCss(this.attr("class"),a)),this)},a.fn.lt_ensure_id=function(){return this.filter(function(){return!this.id}).each(function(){this.id="rect-"+Math.round((new Date).getTime()+100*Math.random())}),this};var h=function(b,c){this.$element=a(b),this.$ghost=null,this.$mask=null,this.options=c};h.DEFAULTS={resize:!0,overlap:!1,compact:!0,params:{lg:{gap:1,maxWidth:Number.MAX_VALUE,cols:4,aspect:2/3},md:{gap:2,maxWidth:1200,cols:3,aspect:2/3},sm:{gap:3,maxWidth:992,cols:2,aspect:2/3},xs:{gap:4,maxWidth:768,cols:1,aspect:2/3}}},h.prototype.option=function(a,b){this.options[a]=b},h.prototype.windowWidth=function(){return a(window).width()},h.prototype.size=function(){var b,c=this.windowWidth();return a.each(this.options.params,function(a,d){c<d.maxWidth&&(b=a)}),b},h.prototype.ghost=function(b){return null===this.$ghost&&(this.$ghost=a('<div class="'+b.attr("class")+' lt-ghost"></div>'),this.$element.append(this.$ghost)),this.$ghost},h.prototype.removeGhost=function(){this.$ghost&&(this.$ghost.remove(),this.$ghost=null)},h.prototype.compact=function(){var a=this.size();this.grid(a,this.grid(a).compact())},h.prototype.resize=function(){var a=this.size(),b=new f(0,0,0,this.grid(a).height());this.$element.attr("class",b.setCss(this.$element.attr("class"),a))},h.prototype.itemWidth=function(a){return(this.$element.width()-(this.options.params[a].cols-1)*this.options.params[a].gap)/this.options.params[a].cols},h.prototype.itemHeight=function(a){return this.itemWidth(a)*this.options.params[a].aspect},h.prototype.moveGhost=function(a,b,c){var d=this.size(),e=this.ghost(a),f=e.lt_rect(d);f.x=Math.floor(b/(this.itemWidth(d)+this.options.params[d].gap)),f.y=Math.floor(c/(this.itemHeight(d)+this.options.params[d].gap)),f.x=Math.min(Math.max(0,f.x),this.options.params[d].cols-f.w),e.lt_rect(d,f)},h.prototype.end=function(){this.removeMask(),this.removeGhost(),this.options.compact&&this.compact(),this.options.resize&&this.resize()},h.prototype.mask=function(){return null===this.$mask&&(this.$mask=a('<div class="lt-mask" data-lt-grid="mask"></div>'),this.$element.append(this.$mask)),this.$mask},h.prototype.removeMask=function(){null!==this.$mask&&(this.$mask.remove(),this.$mask=null)},h.prototype.grid=function(c,d){var e=this.$element.children("[draggable]");return b===d?new g(a.map(e.toArray(),function(b){return a(b).lt_rect(c)})):void a.each(d.rects,function(a,b){e.eq(a).lt_rect(c,b)})},h.prototype.reposition=function(a,b,c){var d=this.size(),e=a.lt_rect(d),f=this.grid(d);this.options.overlap?f.move(e,b,c):f.moveNoOverlap(e,b,c),this.grid(d,f)},h.prototype.moveToGhost=function(a){var b=this.size(),c=a.parent(),d=this.ghost(a),e=d.lt_rect(b);this.$element.append(a),this.reposition(a,e.x,e.y),c.add(this.$element).lt_grid("end")},a.fn.lt_grid=e,a.fn.lt_grid.Constructor=h,a.lt={Grid:g,Rect:f,saveWidget:c,loadWidget:d},a(document).on("dragstart.lt touchstart.lt",'[data-arrange="layout-grid"] .lt',function(b){c(b,a(this))}).on("dragover.lt touchmove.lt",'[data-arrange="layout-grid"]',function(b){var c=d(b),e=a(this);if(c){var f=b.originalEvent.touches?b.originalEvent.touches[0]:b.originalEvent,g=f.pageX-e.offset().left,h=f.pageY-e.offset().top;b.preventDefault(),e.lt_grid("mask").lt_grid("moveGhost",c,g,h)}}).on("dragend.lt touchcancel.lt",'[data-arrange="layout-grid"]',function(b){a(this).lt_grid("end")}).on("dragleave.lt",'[data-arrange="layout-grid"]',function(b){b.preventDefault(),"mask"==a(b.target).data("lt-grid")&&a(this).lt_grid("end")}).on("drop.lt touchend.lt",'[data-arrange="layout-grid"]',function(b){var c=d(b);c&&(b.preventDefault(),a(this).lt_grid("moveToGhost",c).lt_grid("end"))})}(jQuery);
